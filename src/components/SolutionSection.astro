---
import { storyblokEditable } from '@storyblok/astro';
import { renderRichText } from '@storyblok/js';
import SolutionItem from '../components/SolutionItem.astro';

const { blok } = Astro.props;

const headline = blok?.headline || '';
const images = Array.isArray(blok?.images) ? blok.images : [];
const solutions = Array.isArray(blok?.solutions) ? blok.solutions : [];
---

<section id="solution" data-anchor
  class="solution-section py-section"
  {...storyblokEditable(blok)}
>
  {/* Top image strip (full width, outside page-grid) */}
  {images.length > 0 && (
    <div class="solution-section__image-strip">
      {images.slice(0, 4).map((image: any) => (
        <div class="solution-section__image-shell">
          <img
            src={image.filename}
            alt={image.alt || ''}
            class="solution-section__image"
            loading="lazy"
          />
        </div>
      ))}
    </div>
  )}

  <div class="page-grid">
    {/* Intro: headline + body */}
    <header class="solution-section__intro col-span-12 lg:col-span-7">
      {headline && (
        <h2 class="solution-section__headline text-h3 text-brand-primary">
          {headline}
        </h2>
      )}

      {blok.body && (
        <div
          class="solution-section__body text-body-sm text-brand-on-light"
          set:html={renderRichText(blok.body)}
        />
      )}
    </header>

    {/* Solutions list */}
    {solutions.length > 0 && (
      <div class="solution-section__items col-span-12">
        {solutions.map((solution: any, index: number) => (
          <SolutionItem blok={solution} index={index} />
        ))}
      </div>
    )}

    {/* Source */}
    {blok.source && (
      <footer class="solution-section__source col-span-12">
        <p
          class="solution-section__source-text text-fine text-grey-80"
          set:html={renderRichText(blok.source)}
        />
      </footer>
    )}
  </div>
</section>