---
import { storyblokEditable } from '@storyblok/astro';
import { renderRichText } from '@storyblok/js';
import ChecklistItem from '../components/ChecklistItem.astro';

const { blok } = Astro.props;

const headline = blok?.headline || '';
const image = blok?.image;
const checklist = Array.isArray(blok?.checklist) ? blok.checklist : [];
---

<section
  id="candidate"
  data-anchor
  class="candidate-section candidate-section--v2 py-section"
  data-candidate-section
  {...storyblokEditable(blok)}
>
  <div class="page-grid candidate-v2">
    {/* LEFT: image + checklist */}
    <div class="candidate-v2__left">
      {image && (
        <figure class="candidate-v2__image">
          <img
            src={image.filename}
            alt={image.alt || 'Illustration of a home with solar'}
            loading="lazy"
          />
        </figure>
      )}

      {checklist.length > 0 && (
        <div class="candidate-v2__checklist" data-checklist-viewport aria-label="Checklist">
          <ul class="candidate-v2__checklist-track" data-checklist-track>
            {checklist.map((item: any) => (
              <ChecklistItem blok={item} />
            ))}
          </ul>
        </div>
      )}
    </div>

    {/* RIGHT: headline + body + source */}
    <div class="candidate-v2__right">
      {headline && (
        <h2 class="candidate-v2__headline text-h3 text-brand-on-light">{headline}</h2>
      )}

      {blok.body && (
        <div
          class="candidate-v2__body text-body-sm text-brand-on-light"
          set:html={renderRichText(blok.body)}
        />
      )}

      {blok.source && (
        <p class="candidate-v2__source text-fine" set:html={renderRichText(blok.source)} />
      )}
    </div>
  </div>
</section>
