---
import { useStoryblokApi } from '@storyblok/astro';
import type { SbBlokData } from '@storyblok/astro';

import Layout from '../layouts/layout.astro';
import HeroSection from '../components/HeroSection.astro';
import IntroductionSection from '../components/IntroductionSection.astro';
import PartnerLogoSection from '../components/PartnerLogoSection.astro';
import BenefitsCarouselSection from '../components/BenefitsCarouselSection.astro';
import TabSection from '../components/TabSection.astro';
import CandidateSection from '../components/CandidateSection.astro';
import SolutionSection from '../components/SolutionSection.astro';
import InstallationSection from '../components/InstallationSection.astro';
import DealerSection from '../components/DealerSection.astro';
import BewareSection from '../components/BewareSection.astro';


const storyblokApi = useStoryblokApi();
const version = import.meta.env.DEV ? 'draft' : 'published';

// Fetch home + global nav
const [{ data: homeData }, { data: navData }] = await Promise.all([
  storyblokApi.get('cdn/stories/home', { version }),
  storyblokApi.get('cdn/stories/global-nav', { version }),
]);

const homeStory = homeData.story;
const navStory = navData.story;

// All blocks on the home page
const body: SbBlokData[] = homeStory?.content?.body ?? [];

// Only pick the blocks we have components for *right now*
const heroBlok = body.find(
  (blok) => blok.component === 'hero_section');
const introBlok = body.find(
  (blok) => blok.component === 'introduction_section');
const partnerlogoBlok = body.find(
  (blok) => blok.component === 'partner_logo_section');
const benefitsBlok = body.find(
  (blok) => blok.component === 'benefits_carousel_section');
const tabBlok = body.find(
  (blok) => blok.component === 'tab_section');
const candidateBlok = body.find(
  (blok) => blok.component === 'candidate_section');
const solutionBlok = body.find(
  (blok) => blok.component === 'solution_section');
const installationBlok = body.find(
  (blok) => blok.component === 'installation_section');
const dealerBlok = body.find(
  (blok) => blok.component === 'dealer_section');
const bewareBlok = body.find(
  (blok) => blok.component === 'beware_section');        

const navBlok = navStory?.content;
---

<Layout
  title="NTREG - Home | The Truth About Residential Solar"
  navBlok={navBlok}
>
  {heroBlok && <HeroSection blok={heroBlok} />}
  {introBlok && <IntroductionSection blok={introBlok} />}
  {partnerlogoBlok && <PartnerLogoSection blok={partnerlogoBlok} />}
  {benefitsBlok && <BenefitsCarouselSection blok={benefitsBlok} />}
  {tabBlok && <TabSection blok={tabBlok} />}
  {candidateBlok && <CandidateSection blok={candidateBlok} />}
  {solutionBlok && <SolutionSection blok={solutionBlok} />}
  {installationBlok && <InstallationSection blok={installationBlok} />}
  {dealerBlok && <DealerSection blok={dealerBlok} />}
  {bewareBlok && <BewareSection blok={bewareBlok} />}

</Layout>